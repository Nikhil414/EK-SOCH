---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import { posts } from "../../data/blog-posts";
import { ArrowLeft, Clock, BookOpen } from "lucide-astro";

export async function getStaticPaths() {
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props;

// Helper to highlight specific words in the title
const highlightTitle = (title: string) => {
    let highlighted = title;
    highlighted = highlighted.replace(
        /Real Estate/g,
        '<span class="text-gold">Real Estate</span>',
    );
    highlighted = highlighted.replace(
        /Ek Soch/g,
        '<span class="text-gold">Ek Soch</span>',
    );
    return highlighted;
};

const highlightedTitle = highlightTitle(post.title);
---

<Layout title={`${post.title} | Ek Soch`}>
    <Navbar />

    <main class="bg-deep-black min-h-screen">
        <!-- Reading progress bar -->
        <div class="fixed top-0 left-0 w-full h-[3px] z-50 bg-charcoal/50">
            <div
                class="h-full bg-gold w-0 transition-all"
                id="reading-progress"
            >
            </div>
        </div>

        <!-- ===== TOI-STYLE ARTICLE HEADER ===== -->
        <header class="pt-28 pb-0 border-b border-soft-grey/10">
            <div class="max-w-[1200px] mx-auto px-4 md:px-8">
                <!-- Breadcrumb / Category Bar -->
                <div
                    class="flex items-center gap-3 text-[11px] uppercase tracking-[0.18em] font-bold mb-6 pb-4 border-b border-soft-grey/10 fade-up"
                >
                    <a
                        href="/blog"
                        class="text-soft-grey/50 hover:text-gold transition-colors flex items-center gap-1.5"
                    >
                        <ArrowLeft class="w-3 h-3" />
                        Blog
                    </a>
                    <span class="text-soft-grey/20">/</span>
                    <span class="text-gold">{post.category}</span>
                </div>

                <!-- Headline — Responsive font sizes, optimized for 2 lines -->
                <h1
                    class="font-serif text-off-white leading-[1.15] mb-8 fade-up delay-100 max-w-[950px]
                           text-[1.6rem] sm:text-[2rem] md:text-[2.4rem] lg:text-[3rem]"
                    set:html={highlightedTitle}
                />

                <!-- TOI-style author + meta bar (Responsive stacking) -->
                <div
                    class="flex flex-col sm:flex-row sm:items-center justify-between gap-6 py-6 border-t border-b border-soft-grey/10 mb-10 fade-up delay-200"
                >
                    <div class="flex items-center gap-4">
                        <!-- Author avatar -->
                        <div class="relative flex-shrink-0">
                            <div
                                class="absolute -inset-0.5 bg-gold/30 rounded-full blur opacity-60"
                            >
                            </div>
                            <img
                                src="https://ui-avatars.com/api/?name=Nirale+Pandya&background=D4AF37&color=fff&size=200"
                                alt={post.author}
                                class="relative w-10 h-10 rounded-full border border-gold/40 object-cover"
                            />
                        </div>
                        <div class="leading-tight">
                            <p class="text-off-white text-sm font-semibold">
                                {post.author}
                            </p>
                            <p class="text-soft-grey/50 text-xs">
                                Founder, Niirmaan Growth Hub
                            </p>
                        </div>
                    </div>

                    <div
                        class="flex items-center gap-3 text-soft-grey/50 text-xs border-t border-soft-grey/5 pt-4 sm:border-t-0 sm:pt-0"
                    >
                        <Clock class="w-3.5 h-3.5" />
                        <span>Updated: {post.date}, 03:34 PM IST</span>
                    </div>
                </div>

                <!-- Featured Hero Image (Constrained to content width) -->
                <div class="w-full mb-10 fade-up delay-300">
                    <div
                        class="relative rounded-2xl overflow-hidden aspect-video md:aspect-[16/7] shadow-2xl border border-soft-grey/10"
                    >
                        <img
                            src={post.image}
                            alt={post.title}
                            class="w-full h-full object-cover"
                        />
                        <div
                            class="absolute inset-0 bg-gradient-to-t from-deep-black/60 to-transparent"
                        >
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== TOI-STYLE 2-COLUMN BODY ===== -->
        <div class="max-w-[1200px] mx-auto px-4 md:px-8 py-10">
            <div class="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-12">
                <!-- ---- LEFT: Main Article ---- -->
                <article class="min-w-0">
                    <!-- Lead / Summary pull-quote -->
                    <p
                        class="text-xl md:text-2xl text-off-white/90 font-serif italic font-medium border-l-[3px] border-gold pl-6 mb-10 leading-snug"
                    >
                        {post.excerpt}
                    </p>

                    <div class="flex items-center gap-3 mb-10">
                        <div class="flex-grow h-px bg-soft-grey/15"></div>
                        <BookOpen class="w-4 h-4 text-gold/50 flex-shrink-0" />
                        <div class="flex-grow h-px bg-soft-grey/15"></div>
                    </div>

                    <div
                        class="prose prose-lg prose-invert max-w-none
                               text-off-white/90 leading-[1.65] font-normal
                               prose-headings:font-serif prose-headings:text-white prose-headings:font-bold prose-headings:leading-tight prose-headings:mt-16 prose-headings:mb-10
                               prose-h2:text-4xl prose-h2:border-b prose-h2:border-soft-grey/15 prose-h2:pb-5
                               prose-p:mb-12 prose-p:text-[24px] md:prose-p:text-[28px] prose-p:text-off-white/90
                               prose-strong:text-white prose-strong:font-bold
                               prose-blockquote:border-none prose-blockquote:p-0 prose-blockquote:my-16 prose-blockquote:font-serif prose-blockquote:italic
                               prose-ul:list-disc prose-ul:pl-10 prose-li:mb-6 prose-li:text-[24px] md:prose-li:text-[28px] prose-li:text-off-white/90
                               marker:text-gold/60
                               prose-img:rounded-xl"
                    >
                        <div set:html={post.content} />
                    </div>

                    <div
                        class="mt-16 pt-6 border-t border-soft-grey/10 flex flex-wrap items-center justify-between gap-4"
                    >
                        <p class="text-soft-grey/40 text-xs">
                            Published: {post.date} | Category: {post.category}
                        </p>
                    </div>
                </article>

                <!-- ---- RIGHT: Sidebar ---- -->
                <aside class="hidden lg:block">
                    <div class="sticky top-28 space-y-8">
                        <div
                            class="bg-charcoal/30 border border-soft-grey/10 rounded-2xl p-6"
                        >
                            <h3
                                class="text-xs font-bold uppercase tracking-[0.18em] text-gold border-b border-gold/30 pb-2 mb-4"
                            >
                                About This Podcast
                            </h3>
                            <p
                                class="text-soft-grey/70 text-sm leading-relaxed"
                            >
                                <strong class="text-off-white">Ek Soch</strong> is
                                a podcast at the intersection of ideas, enterprise,
                                and transformation — built for thinkers who act.
                            </p>
                            <a
                                href="https://open.spotify.com/show/03fktpw7KILmHseu9aa6IZ?si=oEuhxQ-XS_6Srt29RSjLcQ&nd=1&dlsi=964337a3ac19456b"
                                target="_blank"
                                class="mt-4 inline-flex items-center gap-2 text-gold text-xs font-bold uppercase tracking-widest hover:underline"
                            >
                                Listen Now →
                            </a>
                        </div>

                        <div
                            class="bg-charcoal/30 border border-soft-grey/10 rounded-2xl p-6"
                        >
                            <h3
                                class="text-xs font-bold uppercase tracking-[0.18em] text-gold border-b border-gold/30 pb-2 mb-4"
                            >
                                About The Author
                            </h3>
                            <div class="flex items-center gap-3 mb-3">
                                <div class="relative">
                                    <div
                                        class="absolute -inset-0.5 bg-gold/20 rounded-full blur"
                                    >
                                    </div>
                                    <img
                                        src="https://ui-avatars.com/api/?name=Nirale+Pandya&background=D4AF37&color=fff&size=200"
                                        alt={post.author}
                                        class="relative w-12 h-12 rounded-full border border-gold/30 object-cover"
                                    />
                                </div>
                                <div>
                                    <p
                                        class="text-off-white font-semibold text-sm"
                                    >
                                        {post.author}
                                    </p>
                                    <p class="text-soft-grey/50 text-xs">
                                        Founder, Niirmaan Growth Hub
                                    </p>
                                </div>
                            </div>
                            <p
                                class="text-soft-grey/60 text-xs leading-relaxed"
                            >
                                Storyteller, entrepreneur, and the voice behind
                                Ek Soch. Helping ideas become movements.
                            </p>
                        </div>

                        <div
                            class="bg-gradient-to-br from-gold/10 to-charcoal/30 border border-gold/20 rounded-2xl p-6"
                        >
                            <h3
                                class="text-xs font-bold uppercase tracking-[0.18em] text-gold border-b border-gold/20 pb-2 mb-3"
                            >
                                Join The Newsletter
                            </h3>
                            <p
                                class="text-soft-grey/70 text-sm mb-4 leading-relaxed"
                            >
                                Weekly insights on ideas, growth & storytelling.
                            </p>
                            <a
                                href="https://niirmaangrowthhub.substack.com/"
                                target="_blank"
                                class="block w-full text-center py-2.5 px-4 rounded-xl bg-gold text-deep-black text-sm font-bold tracking-wide hover:bg-gold/80 transition-colors"
                            >
                                Subscribe Free
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <Footer />
</Layout>

<script>
    // Reading progress bar
    window.addEventListener("scroll", () => {
        const winScroll =
            document.body.scrollTop || document.documentElement.scrollTop;
        const height =
            document.documentElement.scrollHeight -
            document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        const bar = document.getElementById("reading-progress");
        if (bar) bar.style.width = scrolled + "%";
    });

    document.addEventListener("DOMContentLoaded", () => {
        const gsap = (window as any).gsap;
        if (!gsap) return;
        gsap.fromTo(
            ".fade-up",
            { y: 24, opacity: 0 },
            {
                y: 0,
                opacity: 1,
                duration: 0.7,
                stagger: 0.12,
                ease: "power3.out",
                delay: 0.1,
            },
        );
    });
</script>
